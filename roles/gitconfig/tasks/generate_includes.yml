---
# Generate includes.gitconfig with sorted [include] directives
# Reads from _gitconfig_fragments (already sorted by priority and name)

# yamllint disable rule:line-length
- name: "[ðŸ”§ gitconfig] Sort fragments by target name"
  ansible.builtin.set_fact:
    _sorted_fragments: "{{ _gitconfig_fragments | sort(attribute='target_name') }}"

- name: "[ðŸ”§ gitconfig] Write includes.gitconfig"
  ansible.builtin.copy:
    # yamllint disable-line rule:indentation
    content: "# Auto-generated by gitconfig role - do not edit manually\n# Fragment includes sorted by profile priority\n{% for fragment in _sorted_fragments %}\n[include]\npath = {{ gitconfig_conf_d }}/{{ fragment.target_name }}\n{% endfor %}"
    dest: "{{ gitconfig_includes_file }}"
    mode: "0644"
# yamllint enable rule:line-length
