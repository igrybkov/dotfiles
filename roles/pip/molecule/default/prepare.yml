---
- name: Prepare pip role test
  hosts: all
  gather_facts: false
  tasks:
    - name: Install Python and create virtual environment
      ansible.builtin.raw: >
        apt-get update -qq &&
        DEBIAN_FRONTEND=noninteractive apt-get install -y -qq python3 python3-pip python3-venv bash &&
        python3 -m venv /opt/test-venv
      changed_when: false

    # Set test variables as cacheable facts so they're available in hostvars
    # for the aggregated_profile_var lookup plugin
    - name: Set pip_packages as host fact
      ansible.builtin.set_fact:
        pip_packages:
          - name: httpie
            state: present
          - name: rich
            state: present
        cacheable: true
